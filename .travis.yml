stages:
  - test
    if: (type = push AND branch = master) OR (type = pull_request)
  - name: pypi
    if: (type = push AND branch = master)

language: python
services: mongodb

cache: pip

python:
  - "3.6"

install:
  - pip install -r requirements.txt -e .
  - pip install pytest-cov codecov


jobs:
  include:
    - script: pytest -v --cov=./gcmcworkflow
      after_success: codecov
    - stage: pypi
      install: skip
      script: echo hello
      deploy:
        provider: pypi
        user: "richard.j.gowers"
        password:
          secure: "derp"
        on:
          tags: true
